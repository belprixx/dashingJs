var config={lang:"fr",columns:5,margins:[8,8],rowHeight:357.3,colWidth:382.5,items:[{sizeX:1,sizeY:1,row:0,col:0,background:"#686377",icon:null,widget:"image",params:{image:"images/logo.png"}},{sizeX:1,sizeY:1,row:0,col:1,background:"#ec663c",icon:"clock-o",widget:"date",params:{date:!0,clock:!0}},{sizeX:1,sizeY:1,row:0,col:2,background:"#47bbb3",icon:null,widget:"helloworld",params:{}},{sizeX:1,sizeY:1,row:0,col:3,background:"#9c4274",icon:null,widget:"donut",params:{max:100,value:30,legend:"donut exemple"}},{sizeX:1,sizeY:1,row:0,col:4,background:"#000000",icon:null,widget:"giphy",params:{interval:3e4,search:["fail cat","fail sheep"]}},{sizeX:1,sizeY:1,row:1,col:0,background:"#9895F2",icon:null,widget:"value",params:{job:"jobValueA",interval:5e4,title:"clients",symbole:"",goal:"75 at 01/01/17"}},{sizeX:1,sizeY:1,row:1,col:1,background:"#9895F2",icon:null,widget:"value",params:{job:"jobValueB",interval:5e4,title:"formations",symbole:""}},{sizeX:1,sizeY:1,row:1,col:2,background:"#00C044",icon:null,widget:"area",params:{}},{sizeX:1,sizeY:1,row:1,col:3,background:"#333333",icon:null,widget:null,params:{}},{sizeX:1,sizeY:1,row:1,col:4,background:"#00C044",icon:"smile-o",widget:"teamMood",params:{internal:2e3,token:"2bcb9eac-d7a2-4dc7-bd2b-05ecdb9b9798"}},{sizeX:1,sizeY:1,row:2,col:0,background:"#333333",icon:null,widget:null,params:{}},{sizeX:2,sizeY:1,row:2,col:1,background:"#005499",icon:"slack",widget:"slack",params:{interval:5e3,title:"Internal News :)",token:"xoxp-6441704640-89194631024-93351818053-485710c0316b4e87c6be6ef0523b397c",hashtag:"#news",channel:"C2PF6T9AR",maxItems:20,showDate:!0,random:!1}},{sizeX:1,sizeY:1,row:2,col:3,background:"#333333",icon:null,widget:null,params:{}},{sizeX:1,sizeY:1,row:2,col:4,background:"#ff9618",icon:"slack",widget:"slack",params:{interval:5e3,title:"Savez-vous que...",token:"xoxp-6441704640-89194631024-93351818053-485710c0316b4e87c6be6ef0523b397c",hashtag:"#affirmation",channel:"C2PF6T9AR",maxItems:20,showDate:!1,random:!1}}]},dashingJs=angular.module("dashingApp",["ngRoute","dashingApp.dashboard","gridster","angularMoment","ngSanitize","btford.markdown","ngAnimate","emoji","oc.lazyLoad"]).constant("config",config).run(["gridsterConfig","config",function(gridsterConfig,config){gridsterConfig.columns=config.columns,gridsterConfig.margins=config.margins,gridsterConfig.rowHeight=config.rowHeight,gridsterConfig.colWidth=config.colWidth,gridsterConfig.resizable={enabled:!1,handles:[]},gridsterConfig.draggable={enabled:!1},gridsterConfig.pushing=!1,gridsterConfig.floating=!1,gridsterConfig.swapping=!0,gridsterConfig.outerMargin=!1}]).run(function(amMoment){amMoment.changeLocale(config.lang)}).config(["$locationProvider","$routeProvider","$httpProvider",function($locationProvider,$routeProvider,$httpProvider){$locationProvider.hashPrefix("!"),$routeProvider.otherwise({redirectTo:"/dashboard"}),$httpProvider.defaults.useXDomain=!0}]).directive("dynamicCtrl",["$compile","$parse",function($compile,$parse){return{restrict:"A",terminal:!0,priority:1e5,link:function(scope,elem){var name=$parse(elem.attr("dynamic-ctrl"))(scope);elem.removeAttr("dynamic-ctrl"),elem.attr("ng-controller",name),$compile(elem)(scope)}}}]);dashingJs.factory("jobValueA",function($http){return{getValue:function(){return $http.get("http://localhost:9000/server/valueA.yml")}}}).factory("jobValueB",function($http){return{getValue:function(){return $http.get("http://localhost:9000/server/valueB.yml")}}}),angular.module("dashingApp.dashboard",["ngRoute"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/dashboard",{templateUrl:"/views/dashbord.html",controller:"DashboardCtrl"})}]).controller("DashboardCtrl",function($scope,config){$scope.items=config.items}),angular.module("dashingApp.dashboard").controller("dashingJsDateCtrl",function($scope,config,$element,$timeout,$sce,$compile){$scope.tickInterval=1e3,$scope.date_format="EEE dd MMM yyyy",$scope.clock_format="HH:mm:ss";var tick=function(){$scope.now=Date.now(),$timeout(tick,$scope.tickInterval)};$timeout(tick,$scope.tickInterval)}),dashingJs.controller("dashingJsImageCtrl",function($scope){$scope.image=$scope.item.params.image||null}),dashingJs.controller("dashingJsHelloWorldCtrl",function($scope){$scope.hello="hello world!"}),dashingJs.controller("dashingJsGiphyCtrl",function($scope,$http,$interval){function setImage(){var search=$scope.item.params.search[Math.floor(Math.random()*$scope.item.params.search.length)];$http({method:"GET",url:"http://api.giphy.com/v1/gifs/search?q="+encodeURIComponent(search)+"&api_key=dc6zaTOxFJmzC&limit=1000"}).then(function(response){var items=response.data.data,item=items[Math.floor(Math.random()*items.length)];$scope.image=item.images.fixed_height.url})}$interval(setImage,$scope.item.params.interval),setImage()}),dashingJs.controller("dashingJsDonutCtrl",function($scope,$http,$interval,$element){$scope.value=$scope.item.params.value,$scope.max=$scope.item.params.max,$scope.legend=$scope.item.params.legend,$scope.updatedAt=new Date,$($element).find(".donut").highcharts({credits:{enabled:!1},chart:{backgroundColor:"transparent",borderColor:"transparent",borderWidth:0,plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1,margin:[0,0,0,0],spacingTop:0,spacingBottom:0,spacingLeft:0,spacingRight:0,width:300},title:{text:"",align:"center",verticalAlign:"middle",y:40,style:{display:"none"}},legend:{style:{fontSize:25,color:"#ffffff"}},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{borderWidth:0,dataLabels:{enabled:!0,distance:-70,style:{fontWeight:"bold",color:"white"}},startAngle:-130,endAngle:130,center:["50%","75%"]}},series:[{type:"pie",name:"",innerSize:"60%",data:[["",30],["",70]]}]})}),dashingJs.controller("dashingJsValueCtrl",["$scope","$http","$interval","$injector",function($scope,$http,$interval,$injector){function getValue(){job.getValue().success(function(response){$scope.value=response.value,$scope.oldValue=response.oldValue,$scope.at=new Date})}$scope.title=$scope.item.params.title;var job=$injector.get($scope.item.params.job);$scope.goal=$scope.item.params.goal,$interval(getValue,$scope.item.params.interval),getValue()}]),dashingJs.controller("dashingJsAreaCtrl",function($scope,$http,$interval,$element){$(function(){$($element).find(".donut").highcharts({chart:{type:"area",animation:Highcharts.svg,marginRight:10,events:{load:function(){var series=this.series[0];setInterval(function(){var x=(new Date).getTime(),y=Math.random();series.addPoint([x,y],!0,!0)},1e3)}}},title:{text:"Live random data"},xAxis:{type:"datetime",tickPixelInterval:150},yAxis:{title:{text:"Value"},plotLines:[{value:0,width:0,color:"#FFFFFF"}]},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)+"<br/>"+Highcharts.numberFormat(this.y,2)}},legend:{enabled:!1},exporting:{enabled:!1},series:[{name:"Random data",data:function(){var i,data=[],time=(new Date).getTime();for(i=-19;i<=0;i+=1)data.push({x:time+1e3*i,y:Math.random()});return data}()}]})})}),dashingJs.controller("dashingJsTeamMoodCtrl",function($scope,$http,$interval,$element){function setShowingTeamMood(){$scope.moods={bad:[],hard:[],average:[],good:[],excellent:[]},$scope.comments=[],$scope.showing+1>=$scope.tags.length||null===$scope.showing?$scope.showing=0:$scope.showing++;var tag=$scope.tags[$scope.showing];$scope.title=tag;for(var i in moods)moods[i].tags.indexOf(tag)!==-1&&($scope.moods[moods[i].mood]||($scope.moods[moods[i].mood]=[]),$scope.moods[moods[i].mood].push(moods[i]),moods[i].comment&&$scope.comments.push(moods[i]));var tendance="bad";$scope.moods.hard.length>=$scope.moods.bad.length&&(tendance="hard"),$scope.moods.hard.length>=$scope.moods.hard.length&&(tendance="average"),$scope.moods.good.length>=$scope.moods.average.length&&(tendance="good"),$scope.moods.excellent.length>=$scope.moods.good.length&&(tendance="excellent"),$($element).removeClass("bad").removeClass("hard").removeClass("average").removeClass("good").removeClass("excellent"),$($element).addClass(tendance)}function setShowingCommentTeamMood(){$scope.showingComment+1>=$scope.comments.length||null===$scope.showingComment?$scope.showingComment=0:$scope.showingComment++}$scope.title="&nbsp;",$scope.loading=!0,$scope.dependentiesLoading=!0,$scope.token=$scope.item.params.token,$scope.moods=[],$scope.tags=[],$scope.showing=null,$scope.showingMessage=null;var moods=[];$scope.getMoods=function(){$http({method:"GET",url:"https://jsonp.afeld.me/?url=http://app.teammood.com/api/"+$scope.token+"/moods?since=30"}).then(function(response){var data=response.data.days[0]||null;if(data&&data.values.length){$scope.at=new Date(data.nativeDate);for(var i in data.values){var item=data.values[i];moods.push(item);for(var ii in item.tags){var tag=item.tags[ii]||null;tag&&$scope.tags.indexOf(tag)===-1&&$scope.tags.push(tag)}}$scope.loading=!1,setShowingTeamMood(),setShowingCommentTeamMood()}})},$interval($scope.getMoods,3e5),$scope.getMoods(),$interval(setShowingTeamMood,3e3),$interval(setShowingCommentTeamMood,5e3)}),dashingJs.controller("dashingJsSlackCtrl",function($scope,$http,$interval){function setShowing(){$scope.showing+1>=$scope.items.length||null===$scope.showing?$scope.showing=0:$scope.showing++,$scope.items[$scope.showing]&&($scope.at=new Date(1e3*$scope.items[$scope.showing].ts.split(".")[0]))}$scope.title=$scope.item.params.title,$scope.items=[],$scope.loading=!0,$scope.showing=null,$scope.hashtag=$scope.item.params.hashtag,$scope.showDate=$scope.item.params.showDate,$scope.getMessage=function(){$scope.item.params.hastag;$http({method:"GET",url:"https://slack.com/api/channels.history?pretty=1&token="+$scope.item.params.token+"&channel="+$scope.item.params.channel+"&pretty=1"}).then(function(response){var items=response.data.messages;for(var i in items){if($scope.length>=$scope.item.params.maxItems)break;var item=items[i],patt=new RegExp($scope.hashtag);if("message"===item.type&&patt.test(item.text)){item.text=item.text.replace(/(<([^>]+)>)/gi,"").replace($scope.hashtag,"");var message=item;$http({method:"GET",url:"https://slack.com/api/users.info?pretty=1&token="+$scope.item.params.token+"&user="+item.user}).then(function(response){message.userData=response.data.user,$scope.items.push(message),$scope.item.params.shuffle&&$scope.shuffle($scope.items)})}}$scope.loading=!1})},$scope.shuffle=function(a){for(var i=a.length;i;i--){var j=parseInt(Math.random()*i,10);[a[i-1],a[j]]=[a[j],a[i-1]]}},$interval($scope.getMessage,3e5),$scope.getMessage();$interval(setShowing,$scope.item.params.interval);setShowing()});